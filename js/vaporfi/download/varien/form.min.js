VarienForm=Class.create();VarienForm.prototype={initialize:function(e,t){this.form=$(e);if(!this.form){return}this.cache=$A();this.currLoader=false;this.currDataIndex=false;this.validator=new Validation(this.form);this.elementFocus=this.elementOnFocus.bindAsEventListener(this);this.elementBlur=this.elementOnBlur.bindAsEventListener(this);this.childLoader=this.onChangeChildLoad.bindAsEventListener(this);this.highlightClass="highlight";this.extraChildParams="";this.firstFieldFocus=t||false;this.bindElements();if(this.firstFieldFocus){try{Form.Element.focus(Form.findFirstElement(this.form))}catch(n){}}},submit:function(e){if(this.validator&&this.validator.validate()){this.form.submit()}return false},bindElements:function(){var e=Form.getElements(this.form);for(var t in e){if(e[t].id){Event.observe(e[t],"focus",this.elementFocus);Event.observe(e[t],"blur",this.elementBlur)}}},elementOnFocus:function(e){var t=Event.findElement(e,"fieldset");if(t){Element.addClassName(t,this.highlightClass)}},elementOnBlur:function(e){var t=Event.findElement(e,"fieldset");if(t){Element.removeClassName(t,this.highlightClass)}},setElementsRelation:function(e,t,n,r){if(e=$(e)){if(!this.cache[e.id]){this.cache[e.id]=$A();this.cache[e.id]["child"]=t;this.cache[e.id]["dataUrl"]=n;this.cache[e.id]["data"]=$A();this.cache[e.id]["first"]=r||false}Event.observe(e,"change",this.childLoader)}},onChangeChildLoad:function(e){element=Event.element(e);this.elementChildLoad(element)},elementChildLoad:function(e,t){this.callback=t||false;if(e.value){this.currLoader=e.id;this.currDataIndex=e.value;if(this.cache[e.id]["data"][e.value]){this.setDataToChild(this.cache[e.id]["data"][e.value])}else{new Ajax.Request(this.cache[this.currLoader]["dataUrl"],{method:"post",parameters:{parent:e.value},onComplete:this.reloadChildren.bind(this)})}}},reloadChildren:function(transport){var data=eval("("+transport.responseText+")");this.cache[this.currLoader]["data"][this.currDataIndex]=data;this.setDataToChild(data)},setDataToChild:function(e){if(e.length){var t=$(this.cache[this.currLoader]["child"]);if(t){var n='<select name="'+t.name+'" id="'+t.id+'" class="'+t.className+'" title="'+t.title+'" '+this.extraChildParams+">";if(this.cache[this.currLoader]["first"]){n+='<option value="">'+this.cache[this.currLoader]["first"]+"</option>"}for(var r in e){if(e[r].value){n+='<option value="'+e[r].value+'"';if(t.value&&(t.value==e[r].value||t.value==e[r].label)){n+=" selected"}n+=">"+e[r].label+"</option>"}}n+="</select>";Element.insert(t,{before:n});Element.remove(t)}}else{var t=$(this.cache[this.currLoader]["child"]);if(t){var n='<input type="text" name="'+t.name+'" id="'+t.id+'" class="'+t.className+'" title="'+t.title+'" '+this.extraChildParams+">";Element.insert(t,{before:n});Element.remove(t)}}this.bindElements();if(this.callback){this.callback()}}};RegionUpdater=Class.create();RegionUpdater.prototype={initialize:function(e,t,n,r,i,s){this.countryEl=$(e);this.regionTextEl=$(t);this.regionSelectEl=$(n);this.zipEl=$(s);this.config=r["config"];delete r.config;this.regions=r;this.disableAction=typeof i=="undefined"?"hide":i;this.zipOptions=typeof zipOptions=="undefined"?false:zipOptions;if(this.regionSelectEl.options.length<=1){this.update()}Event.observe(this.countryEl,"change",this.update.bind(this))},_checkRegionRequired:function(){var e,t;var n=[this.regionTextEl,this.regionSelectEl];var r=this;if(typeof this.config=="undefined"){return}var i=this.config.regions_required.indexOf(this.countryEl.value)>=0;n.each(function(n){Validation.reset(n);e=$$('label[for="'+n.id+'"]')[0];if(e){t=e.down("em")||e.down("span.required");if(!r.config.show_all_regions){if(i){e.up().show()}else{e.up().hide()}}}if(e&&t){if(!i){t.hide();if(e.hasClassName("required")){e.removeClassName("required")}}else if(i){t.show();if(!e.hasClassName("required")){e.addClassName("required")}}}if(!i){if(n.hasClassName("required-entry")){n.removeClassName("required-entry")}if("select"==n.tagName.toLowerCase()&&n.hasClassName("validate-select")){n.removeClassName("validate-select")}}else{if(!n.hasClassName("required-entry")){n.addClassName("required-entry")}if("select"==n.tagName.toLowerCase()&&!n.hasClassName("validate-select")){n.addClassName("validate-select")}}})},update:function(){if(this.regions[this.countryEl.value]){var e,t,n,r;r=this.regionSelectEl.getAttribute("defaultValue");if(this.regionTextEl){if(!r){r=this.regionTextEl.value.toLowerCase()}this.regionTextEl.value=""}this.regionSelectEl.options.length=1;for(regionId in this.regions[this.countryEl.value]){n=this.regions[this.countryEl.value][regionId];t=document.createElement("OPTION");t.value=regionId;t.text=n.name.stripTags();t.title=n.name;if(this.regionSelectEl.options.add){this.regionSelectEl.options.add(t)}else{this.regionSelectEl.appendChild(t)}if(regionId==r||n.name&&n.name.toLowerCase()==r||n.name&&n.code.toLowerCase()==r){this.regionSelectEl.value=regionId}}if(this.disableAction=="hide"){if(this.regionTextEl){this.regionTextEl.style.display="none"}this.regionSelectEl.style.display=""}else if(this.disableAction=="disable"){if(this.regionTextEl){this.regionTextEl.disabled=true}this.regionSelectEl.disabled=false}this.setMarkDisplay(this.regionSelectEl,true)}else{if(this.disableAction=="hide"){if(this.regionTextEl){this.regionTextEl.style.display=""}this.regionSelectEl.style.display="none";Validation.reset(this.regionSelectEl)}else if(this.disableAction=="disable"){if(this.regionTextEl){this.regionTextEl.disabled=false}this.regionSelectEl.disabled=true}else if(this.disableAction=="nullify"){this.regionSelectEl.options.length=1;this.regionSelectEl.value="";this.regionSelectEl.selectedIndex=0;this.lastCountryId=""}this.setMarkDisplay(this.regionSelectEl,false)}this._checkRegionRequired();var i=new ZipUpdater(this.countryEl.value,this.zipEl);i.update()},setMarkDisplay:function(e,t){e=$(e);var n=e.up(0).down("label > span.required")||e.up(1).down("label > span.required")||e.up(0).down("label.required > em")||e.up(1).down("label.required > em");if(n){inputElement=n.up().next("input");if(t){n.show();if(inputElement){inputElement.addClassName("required-entry")}}else{n.hide();if(inputElement){inputElement.removeClassName("required-entry")}}}}};ZipUpdater=Class.create();ZipUpdater.prototype={initialize:function(e,t){this.country=e;this.zipElement=$(t)},update:function(){if(typeof optionalZipCountries=="undefined"){return false}if(this.zipElement!=undefined){this._setPostcodeOptional()}else{Event.observe(window,"load",this._setPostcodeOptional.bind(this))}},_setPostcodeOptional:function(){this.zipElement=$(this.zipElement);if(this.zipElement==undefined){return false}var e=$$('label[for="'+this.zipElement.id+'"]')[0];if(e!=undefined){var t=e.down("em")||e.down("span.required")}if(optionalZipCountries.indexOf(this.country)!=-1){while(this.zipElement.hasClassName("required-entry")){this.zipElement.removeClassName("required-entry")}if(t!=undefined){t.hide()}}else{this.zipElement.addClassName("required-entry");if(t!=undefined){t.show()}}}}